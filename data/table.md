Отлично, схема стала еще лучше! Теперь перейдем к разработке физической модели для PostgreSQL.

В физической модели мы определим:

1.  **Все необходимые поля** для каждой таблицы с указанием их **типов данных**.
2.  **Первичные (PK) и внешние (FK) ключи**.
3.  **Ограничения (Constraints)**, такие как `NOT NULL`, `UNIQUE`, `CHECK`.
4.  **Индексированные поля** (помимо PK и FK, которые обычно индексируются автоматически).
5.  **Потенциальные триггеры**.
6.  **Роли пользователей и их права**.
7.  **Представления (Views)**.

**Соглашения:**

*   Типы данных будем использовать PostgreSQL.
*   `SERIAL` или `BIGSERIAL` для автоинкрементных первичных ключей.
*   `VARCHAR(n)` для текстовых строк ограниченной длины.
*   `TEXT` для длинных текстовых описаний.
*   `INTEGER` или `BIGINT` для целочисленных значений.
*   `NUMERIC(precision, scale)` для денежных значений и точных расчетов.
*   `DATE` для дат, `TIME` для времени, `TIMESTAMP` или `TIMESTAMPTZ` для даты и времени.
*   `BOOLEAN` для логических значений.

---

**Физическая модель (Таблицы, Поля, Типы данных, Ключи, Индексы):**

**1. `Должность` (Position)**

| Поле             | Тип данных         | Ограничения                 | Индекс | Описание                   |
| :--------------- | :----------------- | :-------------------------- | :----- | :------------------------- |
| `ID_должности`   | `SERIAL`           | `PRIMARY KEY`               | Да     | Уникальный ID должности    |
| `Название`       | `VARCHAR(100)`     | `NOT NULL`, `UNIQUE`        | Да     | Название должности         |
| `Ставка_в_час`   | `NUMERIC(10, 2)`   | `NOT NULL`, `CHECK(>0)`     |        | Почасовая ставка           |
| `Описание`       | `TEXT`             |                             |        | Описание должностных_обязанностей |

**2. `Сотрудник` (Employee)**

| Поле           | Тип данных       | Ограничения                                   | Индекс | Описание                  |
| :------------- | :--------------- | :-------------------------------------------- | :----- | :------------------------ |
| `ID_сотрудника` | `SERIAL`         | `PRIMARY KEY`                                 | Да     | Уникальный ID сотрудника  |
| `ID_должности` | `INTEGER`        | `NOT NULL`, `REFERENCES Должность(ID_должности)` | Да     | ID должности сотрудника   |
| `Фамилия`      | `VARCHAR(100)`   | `NOT NULL`                                    | Да     | Фамилия                   |
| `Имя`          | `VARCHAR(100)`   | `NOT NULL`                                    | Да     | Имя                       |
| `Отчество`     | `VARCHAR(100)`   |                                               |        | Отчество                  |
| `Телефон`      | `VARCHAR(20)`    | `UNIQUE`                                      | Да     | Контактный телефон        |
| `Email`        | `VARCHAR(100)`   | `UNIQUE`                                      | Да     | Электронная почта         |
| `Дата_приема`  | `DATE`           | `NOT NULL`, `DEFAULT CURRENT_DATE`            |        | Дата приема на работу     |
| `Активен`      | `BOOLEAN`        | `NOT NULL`, `DEFAULT TRUE`                    |        | Статус сотрудника (работает/уволен) |

**3. `Касса` (CashRegister)**

| Поле      | Тип данных     | Ограничения           | Индекс | Описание          |
| :-------- | :------------- | :-------------------- | :----- | :---------------- |
| `ID_кассы`  | `SERIAL`       | `PRIMARY KEY`         | Да     | Уникальный ID кассы |
| `Номер_кассы` | `VARCHAR(50)`  | `NOT NULL`, `UNIQUE`  | Да     | Номер кассы       |
| `Расположение`| `VARCHAR(255)` | `NOT NULL`            |        | Местоположение кассы |

**4. `Смена` (WorkShift)**

| Поле         | Тип данных   | Ограничения                                     | Индекс | Описание                |
| :----------- | :----------- | :---------------------------------------------- | :----- | :---------------------- |
| `ID_смены`   | `SERIAL`     | `PRIMARY KEY`                                   | Да     | Уникальный ID смены     |
| `ID_сотрудника`| `INTEGER`    | `NOT NULL`, `REFERENCES Сотрудник(ID_сотрудника)` | Да     | ID сотрудника на смене  |
| `ID_кассы`   | `INTEGER`    | `REFERENCES Касса(ID_кассы)`                    | Да     | ID кассы (если смена кассира) |
| `Дата_смены` | `DATE`       | `NOT NULL`, `DEFAULT CURRENT_DATE`              | Да     | Дата смены              |
| `Время_начала`| `TIME`       | `NOT NULL`                                      |        | Время начала смены      |
| `Время_окончания`| `TIME`     |                                                 |        | Время окончания смены   |
| `Тип_смены`  | `VARCHAR(50)`| `NOT NULL`                                      |        | Например, "полная", "утренняя" |

**5. `КатегорияПродукта` (ProductCategory)**

| Поле                | Тип данных     | Ограничения           | Индекс | Описание                     |
| :------------------ | :------------- | :-------------------- | :----- | :--------------------------- |
| `ID_категории_продукта` | `SERIAL`   | `PRIMARY KEY`         | Да     | Уникальный ID категории      |
| `Название`          | `VARCHAR(100)` | `NOT NULL`, `UNIQUE`  | Да     | Название категории продукта  |

**6. `ЕдиницаИзмерения` (UnitOfMeasure)**

| Поле                   | Тип данных     | Ограничения           | Индекс | Описание                        |
| :--------------------- | :------------- | :-------------------- | :----- | :------------------------------ |
| `ID_единицы_измерения` | `SERIAL`       | `PRIMARY KEY`         | Да     | Уникальный ID единицы измерения |
| `Название`             | `VARCHAR(50)`  | `NOT NULL`, `UNIQUE`  | Да     | Название (кг, л, шт, г)         |
| `Краткое_название`     | `VARCHAR(10)`  | `NOT NULL`, `UNIQUE`  | Да     | Краткое обозначение (кг, л)     |

**7. `Продукт` (Product)**

| Поле                  | Тип данных       | Ограничения                                                                 | Индекс | Описание                     |
| :-------------------- | :--------------- | :-------------------------------------------------------------------------- | :----- | :--------------------------- |
| `ID_продукта`           | `SERIAL`         | `PRIMARY KEY`                                                               | Да     | Уникальный ID продукта       |
| `ID_категории_продукта` | `INTEGER`        | `NOT NULL`, `REFERENCES КатегорияПродукта(ID_категории_продукта)`           | Да     | ID категории продукта        |
| `ID_единицы_измерения`| `INTEGER`        | `NOT NULL`, `REFERENCES ЕдиницаИзмерения(ID_единицы_измерения)`             | Да     | ID единицы измерения         |
| `Название`            | `VARCHAR(255)`   | `NOT NULL`, `UNIQUE`                                                        | Да     | Название продукта            |
| `Описание`            | `TEXT`           |                                                                             |        | Описание продукта            |
| `Срок_годности_дни`   | `INTEGER`        | `CHECK(>0)`                                                                 |        | Срок годности в днях (если применимо) |
| `Мин_остаток`         | `NUMERIC(10,3)`  | `DEFAULT 0`, `CHECK(>=0)`                                                   |        | Минимальный остаток для оповещения |

**8. `КатегорияБлюда` (DishCategory)**

| Поле               | Тип данных     | Ограничения           | Индекс | Описание                  |
| :----------------- | :------------- | :-------------------- | :----- | :------------------------ |
| `ID_категории_блюда` | `SERIAL`       | `PRIMARY KEY`         | Да     | Уникальный ID категории   |
| `Название`         | `VARCHAR(100)` | `NOT NULL`, `UNIQUE`  | Да     | Название категории блюда  |

**9. `Блюдо` (Dish)**

| Поле                | Тип данных       | Ограничения                                                        | Индекс | Описание               |
| :------------------ | :--------------- | :----------------------------------------------------------------- | :----- | :--------------------- |
| `ID_блюда`            | `SERIAL`         | `PRIMARY KEY`                                                      | Да     | Уникальный ID блюда    |
| `ID_категории_блюда`  | `INTEGER`        | `NOT NULL`, `REFERENCES КатегорияБлюда(ID_категории_блюда)`        | Да     | ID категории блюда     |
| `Название`          | `VARCHAR(255)`   | `NOT NULL`, `UNIQUE`                                               | Да     | Название блюда         |
| `Описание`          | `TEXT`           |                                                                    |        | Описание блюда         |
| `Цена_продажи`      | `NUMERIC(10, 2)` | `NOT NULL`, `CHECK(>0)`                                            |        | Цена продажи блюда     |
| `Время_приготовления_мин` | `INTEGER`  | `CHECK(>0)`                                                        |        | Время приготовления в минутах |
| `Активно`           | `BOOLEAN`        | `NOT NULL`, `DEFAULT TRUE`                                         |        | Доступно ли блюдо для заказа |
| `Фото_URL`          | `VARCHAR(255)`   |                                                                    |        | URL фотографии блюда   |

**10. `СоставБлюда` (DishComposition)**

| Поле        | Тип данных      | Ограничения                                                               | Индекс | Описание                           |
| :---------- | :-------------- | :------------------------------------------------------------------------ | :----- | :--------------------------------- |
| `ID_блюда`    | `INTEGER`       | `NOT NULL`, `REFERENCES Блюдо(ID_блюда) ON DELETE CASCADE`                | Да     | ID блюда                           |
| `ID_продукта` | `INTEGER`       | `NOT NULL`, `REFERENCES Продукт(ID_продукта)`                             | Да     | ID продукта (ингредиента)          |
| `Количество`  | `NUMERIC(10,3)` | `NOT NULL`, `CHECK(>0)`                                                   |        | Количество продукта в блюде (в его ЕИ) |
|             |                 | `PRIMARY KEY (ID_блюда, ID_продукта)`                                     | Да     |                                    |

**11. `Склад` (Warehouse)**

| Поле      | Тип данных     | Ограничения           | Индекс | Описание          |
| :-------- | :------------- | :-------------------- | :----- | :---------------- |
| `ID_склада` | `SERIAL`       | `PRIMARY KEY`         | Да     | Уникальный ID склада |
| `Название`  | `VARCHAR(100)` | `NOT NULL`, `UNIQUE`  | Да     | Название склада   |
| `Адрес`     | `VARCHAR(255)` | `NOT NULL`            |        | Адрес склада      |

**12. `Поступление` (Supply)**

| Поле                 | Тип данных   | Ограничения                                                             | Индекс | Описание                    |
| :------------------- | :----------- | :---------------------------------------------------------------------- | :----- | :-------------------------- |
| `ID_поступления`       | `SERIAL`     | `PRIMARY KEY`                                                           | Да     | Уникальный ID поступления   |
| `ID_склада`          | `INTEGER`    | `NOT NULL`, `REFERENCES Склад(ID_склада)`                               | Да     | ID склада поступления       |
| `ID_сотрудника_принявшего` | `INTEGER` | `NOT NULL`, `REFERENCES Сотрудник(ID_сотрудника)`                     | Да     | ID сотрудника, принявшего товар |
| `Дата_поступления`   | `TIMESTAMP`  | `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`                                 | Да     | Дата и время поступления    |
| `Номер_накладной`    | `VARCHAR(50)`|                                                                         | Да     | Номер сопроводительной накладной |
| `ID_поставщика`      | `INTEGER`    | `REFERENCES Поставщик(ID_поставщика)` (*Если будет таблица Поставщик*) | Да     | ID поставщика               |
| `Комментарий`        | `TEXT`       |                                                                         |        | Комментарий к поступлению   |

**13. `ПозицияПоступления` (SupplyItem)**

| Поле             | Тип данных      | Ограничения                                                                  | Индекс | Описание                          |
| :--------------- | :-------------- | :--------------------------------------------------------------------------- | :----- | :-------------------------------- |
| `ID_поступления`   | `INTEGER`       | `NOT NULL`, `REFERENCES Поступление(ID_поступления) ON DELETE CASCADE`       | Да     | ID поступления                    |
| `ID_продукта`    | `INTEGER`       | `NOT NULL`, `REFERENCES Продукт(ID_продукта)`                                | Да     | ID поступившего продукта          |
| `Количество`       | `NUMERIC(10,3)` | `NOT NULL`, `CHECK(>0)`                                                      |        | Количество поступившего продукта  |
| `Цена_закупки`     | `NUMERIC(10,2)` | `NOT NULL`, `CHECK(>=0)`                                                     |        | Цена закупки за единицу продукта  |
| `Срок_годности_до` | `DATE`          |                                                                              |        | Срок годности конкретной партии   |
|                  |                 | `PRIMARY KEY (ID_поступления, ID_продукта)` (*Может быть дублирование если продукт один и тот же но с разным сроком годности. Лучше `SERIAL` PK и `UNIQUE(ID_поступления, ID_продукта, Срок_годности_до)`*) | Да     |                                   |

*Примечание по `ПозицияПоступления`: если один и тот же продукт в одном поступлении может приходить с разными сроками годности или по разным ценам (редко, но возможно), то композитный PK `(ID_поступления, ID_продукта)` может быть недостаточен. Тогда лучше добавить `ID_позиции_поступления SERIAL PRIMARY KEY` и `UNIQUE (ID_поступления, ID_продукта)`. Для простоты оставим пока композитный.*

**14. `ПричинаСписания` (WriteOffReason)**

| Поле                   | Тип данных     | Ограничения           | Индекс | Описание                       |
| :--------------------- | :------------- | :-------------------- | :----- | :----------------------------- |
| `ID_причины_списания`  | `SERIAL`       | `PRIMARY KEY`         | Да     | Уникальный ID причины списания |
| `Название`             | `VARCHAR(255)` | `NOT NULL`, `UNIQUE`  | Да     | Описание причины (порча, истек срок) |

**15. `Списание` (WriteOff)** (Базовая таблица для наследования)

| Поле                       | Тип данных   | Ограничения                                                               | Индекс | Описание                         |
| :------------------------- | :----------- | :------------------------------------------------------------------------ | :----- | :------------------------------- |
| `ID_списания`                | `SERIAL`     | `PRIMARY KEY`                                                             | Да     | Уникальный ID списания           |
| `ID_сотрудника_ответственного` | `INTEGER`  | `NOT NULL`, `REFERENCES Сотрудник(ID_сотрудника)`                       | Да     | ID сотрудника, проведшего списание |
| `ID_склада`                | `INTEGER`    | `NOT NULL`, `REFERENCES Склад(ID_склада)`                                 | Да     | ID склада, с которого списание    |
| `ID_причины_списания`      | `INTEGER`    | `NOT NULL`, `REFERENCES ПричинаСписания(ID_причины_списания)`             | Да     | ID причины списания              |
| `Дата_списания`            | `TIMESTAMP`  | `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`                                   | Да     | Дата и время списания            |
| `Комментарий`              | `TEXT`       |                                                                           |        | Комментарий к списанию           |

**16. `СписаниеПродуктов` (ProductWriteOffItem)** (Наследует от `Списание`)

| Поле          | Тип данных      | Ограничения                                                                  | Индекс | Описание                   |
| :------------ | :-------------- | :--------------------------------------------------------------------------- | :----- | :------------------------- |
| `ID_списания`   | `INTEGER`       | `PRIMARY KEY`, `REFERENCES Списание(ID_списания) ON DELETE CASCADE`            | Да     | ID списания (из базовой таблицы) |
| `ID_продукта` | `INTEGER`       | `NOT NULL`, `REFERENCES Продукт(ID_продукта)`                                | Да     | ID списываемого продукта   |
| `Количество`    | `NUMERIC(10,3)` | `NOT NULL`, `CHECK(>0)`                                                      |        | Количество списываемого продукта |

**17. `СписаниеБлюд` (DishWriteOffItem)** (Наследует от `Списание`)

| Поле          | Тип данных      | Ограничения                                                                  | Индекс | Описание                 |
| :------------ | :-------------- | :--------------------------------------------------------------------------- | :----- | :----------------------- |
| `ID_списания`   | `INTEGER`       | `PRIMARY KEY`, `REFERENCES Списание(ID_списания) ON DELETE CASCADE`            | Да     | ID списания (из базовой таблицы) |
| `ID_блюда`    | `INTEGER`       | `NOT NULL`, `REFERENCES Блюдо(ID_блюда)`                                     | Да     | ID списываемого блюда    |
| `Количество`    | `INTEGER`       | `NOT NULL`, `CHECK(>0)`                                                      |        | Количество списываемых блюд |

**18. `ОстатокПродуктаНаСкладе` (ProductStock)**

| Поле        | Тип данных      | Ограничения                                                              | Индекс | Описание                      |
| :---------- | :-------------- | :----------------------------------------------------------------------- | :----- | :---------------------------- |
| `ID_склада`   | `INTEGER`       | `NOT NULL`, `REFERENCES Склад(ID_склада) ON DELETE CASCADE`              | Да     | ID склада                     |
| `ID_продукта` | `INTEGER`       | `NOT NULL`, `REFERENCES Продукт(ID_продукта) ON DELETE CASCADE`          | Да     | ID продукта                   |
| `Количество`  | `NUMERIC(10,3)` | `NOT NULL`, `DEFAULT 0`, `CHECK(>=0)`                                    |        | Текущий остаток продукта на складе |
|             |                 | `PRIMARY KEY (ID_склада, ID_продукта)`                                   | Да     |                               |

**19. `Заказ` (Order)**

| Поле                      | Тип данных       | Ограничения                                                          | Индекс | Описание                         |
| :------------------------ | :--------------- | :------------------------------------------------------------------- | :----- | :------------------------------- |
| `ID_заказа`                 | `SERIAL`         | `PRIMARY KEY`                                                        | Да     | Уникальный ID заказа             |
| `ID_кассы`                | `INTEGER`        | `NOT NULL`, `REFERENCES Касса(ID_кассы)`                             | Да     | ID кассы, на которой оформлен заказ |
| `ID_сотрудника_оформившего` | `INTEGER`      | `NOT NULL`, `REFERENCES Сотрудник(ID_сотрудника)`                    | Да     | ID сотрудника, оформившего заказ  |
| `Дата_создания`           | `TIMESTAMP`      | `NOT NULL`, `DEFAULT CURRENT_TIMESTAMP`                              | Да     | Дата и время создания заказа     |
| `Номер_столика`           | `VARCHAR(20)`    |                                                                      |        | Номер столика (если применимо)   |
| `Статус_заказа`           | `VARCHAR(50)`    | `NOT NULL`, `DEFAULT 'Новый'` (*Лучше ENUM или справочник статусов*) | Да     | Статус заказа (Новый, Готовится, Оплачен, Отменен) |
| `Тип_оплаты`              | `VARCHAR(50)`    |                                                                      |        | Наличные, Карта                |
| `Общая_сумма`             | `NUMERIC(12,2)`  | `DEFAULT 0`, `CHECK(>=0)`                                            |        | Общая сумма заказа (может обновляться триггером) |
| `Комментарий`             | `TEXT`           |                                                                      |        | Комментарий к заказу             |

**20. `ПозицияЗаказа` (OrderItem)**

| Поле        | Тип данных      | Ограничения                                                               | Индекс | Описание                        |
| :---------- | :-------------- | :------------------------------------------------------------------------ | :----- | :------------------------------ |
| `ID_заказа`   | `INTEGER`       | `NOT NULL`, `REFERENCES Заказ(ID_заказа) ON DELETE CASCADE`               | Да     | ID заказа                       |
| `ID_блюда`    | `INTEGER`       | `NOT NULL`, `REFERENCES Блюдо(ID_блюда)`                                  | Да     | ID заказанного блюда            |
| `Количество`  | `INTEGER`       | `NOT NULL`, `CHECK(>0)`                                                   |        | Количество заказанных блюд      |
| `Цена_на_момент_заказа` | `NUMERIC(10,2)` | `NOT NULL`, `CHECK(>=0)`                                          |        | Цена блюда на момент заказа     |
|             |                 | `PRIMARY KEY (ID_заказа, ID_блюда)`                                       | Да     |                                 |

---

**Триггеры (Triggers):**

1.  **`TR_ProductStock_After_SupplyItem_Insert`**:
    *   **Событие:** `AFTER INSERT` на `ПозицияПоступления`.
    *   **Действие:** Увеличивает `Количество` в `ОстатокПродуктаНаСкладе` для соответствующего `ID_продукта` и `ID_склада` из `Поступление`. Если записи нет, создает новую.
2.  **`TR_ProductStock_After_ProductWriteOff_Insert`**:
    *   **Событие:** `AFTER INSERT` на `СписаниеПродуктов`.
    *   **Действие:** Уменьшает `Количество` в `ОстатокПродуктаНаСкладе` для соответствующего `ID_продукта` и `ID_склада` из `Списание`.
3.  **`TR_ProductStock_After_DishWriteOff_Insert`**:
    *   **Событие:** `AFTER INSERT` на `СписаниеБлюд`.
    *   **Действие:** Для каждого продукта в `СоставБлюда` списанного блюда уменьшает `Количество` в `ОстатокПродуктаНаСкладе` на соответствующем `ID_склада`.
4.  **`TR_ProductStock_After_OrderItem_Insert_Delete_Update` (При изменении статуса заказа на "Оплачен" или "Готовится"):**
    *   **Событие:** `AFTER INSERT, UPDATE OF Статус_заказа, DELETE` на `ПозицияЗаказа` (или `Заказ`).
    *   **Действие:** Если заказ переходит в статус, подразумевающий списание продуктов (например, "Готовится" или "Оплачен"), то для каждого продукта в `СоставБлюда` каждого блюда в `ПозицияЗаказа` уменьшает `Количество` в `ОстатокПродуктаНаСкладе`. При отмене заказа – возможно, возврат (зависит от бизнес-логики). Это сложный триггер, часто такую логику выносят на уровень приложения.
5.  **`TR_Order_Calc_TotalAmount`**:
    *   **Событие:** `AFTER INSERT, UPDATE, DELETE` на `ПозицияЗаказа`.
    *   **Действие:** Пересчитывает `Общая_сумма` в таблице `Заказ`.
6.  **Проверка целостности наследования `Списание`**:
    *   Триггер или `CHECK` constraint (если возможно в PostgreSQL для таких случаев) для гарантии, что каждая запись в `Списание` связана ровно с одной записью либо в `СписаниеПродуктов`, либо в `СписаниеБлюд`. На практике часто реализуется логикой приложения или созданием отдельного поля "тип списания" в базовой таблице `Списание` и проверкой через `CHECK`.

---

**Пользователи (Роли) и основные права доступа:**

1.  **`developer_role`**:
    *   Полный доступ ко всем объектам БД (`ALL PRIVILEGES`).
2.  **`owner_role` (Владелец заведения)**:
    *   `SELECT` на все таблицы и представления.
    *   `EXECUTE` на функции/процедуры для генерации отчетов.
    *   *Ограниченный* `INSERT`, `UPDATE`, `DELETE` через представления или хранимые процедуры (если это необходимо, обычно операции через приложение).
3.  **`manager_role` (Управляющий на точке)**:
    *   `SELECT`, `INSERT`, `UPDATE`, `DELETE` на таблицы, связанные с его точкой (`Поступление`, `Списание`, `Заказ`, `Смена` – с фильтрацией по складу/кассе точки через RLS или представления).
    *   `SELECT` на справочники (`Продукт`, `Блюдо` и т.д.).
    *   `EXECUTE` на функции/процедуры для отчетов по своей точке.
4.  **`staff_role` (Рабочий персонал - обобщенная роль, можно детализировать)**:
    *   **Кассир/Официант:** `SELECT` на `Блюдо`, `КатегорияБлюда`; `INSERT`, `UPDATE` (ограниченно) на `Заказ`, `ПозицияЗаказа`; `SELECT` на `Касса`, `Смена` (свои).
    *   **Повар:** `SELECT` на `Блюдо`, `СоставБлюда`, `Продукт`, `ОстатокПродуктаНаСкладе`; `UPDATE` статуса заказа (если есть).
    *   Доступ к таблицам `Сотрудник`, `Должность` – только `SELECT` на свои данные (или вообще нет прямого доступа).

*Для реализации прав доступа на уровне строк (Row-Level Security - RLS) в PostgreSQL можно использовать политики RLS.*

---

**Представления (Views):**

1.  **`V_CurrentStockDetailed`**:
    *   Показывает текущие остатки всех продуктов на всех складах с названиями продуктов, категорий, единиц измерения и складов.
    *   Объединяет `ОстатокПродуктаНаСкладе`, `Продукт`, `Склад`, `КатегорияПродукта`, `ЕдиницаИзмерения`.
2.  **`V_DishWithIngredients`**:
    *   Показывает состав каждого блюда с названиями продуктов и их количеством.
    *   Объединяет `Блюдо`, `СоставБлюда`, `Продукт`.
3.  **`V_DishCostPrice`**:
    *   Рассчитывает себестоимость каждого блюда на основе последних цен закупки ингредиентов. *Требует логики для определения "последней цены закупки" (например, из `ПозицияПоступления`)*.
4.  **`V_OrdersDetailed`**:
    *   Подробная информация о заказах: ID заказа, дата, сотрудник, касса, общая сумма, статус, а также список блюд в заказе с количеством и ценой.
    *   Объединяет `Заказ`, `ПозицияЗаказа`, `Блюдо`, `Сотрудник`, `Касса`.
5.  **`V_SalesByPeriod` (параметризованное представление или функция)**:
    *   Отчет о продажах за указанный период: сумма продаж, количество заказов, средний чек, продажи по блюдам.
6.  **`V_EmployeeShifts`**:
    *   Информация о сменах сотрудников с указанием ФИО, должности, даты смены, времени начала и окончания, кассы.
    *   Объединяет `Смена`, `Сотрудник`, `Должность`, `Касса`.
7.  **`V_WriteOffsDetailed`**:
    *   Детальная информация по списаниям: дата, сотрудник, склад, причина, список списанных продуктов/блюд и их количество.
    *   Объединяет `Списание`, `СписаниеПродуктов` (или `СписаниеБлюд`), `Продукт` (или `Блюдо`), `Сотрудник`, `Склад`, `ПричинаСписания`.

---

Это подробный набросок физической модели. Каждый элемент (особенно триггеры и права доступа) требует тщательной проработки и тестирования при реализации. SQL-код для создания этих объектов будет достаточно объемным.