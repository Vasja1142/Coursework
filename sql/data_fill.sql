-- ROLLBACK;
-- TRUNCATE
--     "Смена",
--     "ОстатокПродуктаНаСкладе",
--     "СписаниеПродуктов", -- Дочерняя
--     "СписаниеБлюд",     -- Дочерняя
--     "ПозицияПоступления",
--     "СоставБлюда",
--     "ПозицияЗаказа",
--     "Списание",         -- Родительская для списаний
--     "Поступление",
--     "Заказ",
--     "Сотрудник",
--     "Продукт",
--     "Блюдо",
--     "Склад",
--     "Касса",
--     "ПричинаСписания",
--     "Должность",
--     "ЕдиницаИзмерения",
--     "КатегорияПродукта",
--     "КатегорияБлюда"
-- RESTART IDENTITY CASCADE;
-- Начало транзакции
BEGIN;

-- 1. Заполнение справочных таблиц

INSERT INTO "КатегорияБлюда" ("Название") VALUES
('Роллы'),
('Суши'),
('Напитки'),
('Закуски'),
('Десерты');

INSERT INTO "КатегорияПродукта" ("Название") VALUES
('Рыба и морепродукты'),
('Рис и крупы'),
('Овощи и фрукты'),
('Молочные продукты'),
('Соусы и приправы'),
('Бакалея'),
('Напитки (ингредиенты)');

INSERT INTO "ЕдиницаИзмерения" ("Название", "Краткое_название") VALUES
('Килограмм', 'кг'),
('Грамм', 'г'),
('Литр', 'л'),
('Миллилитр', 'мл'),
('Штука', 'шт'),
('Порция', 'порц');

INSERT INTO "Должность" ("Название", "Ставка_в_час") VALUES
('Повар-сушист', 350.00),
('Помощник повара', 250.00),
('Кассир', 280.00),
('Администратор', 400.00),
('Курьер', 200.00);

INSERT INTO "ПричинаСписания" ("Название") VALUES
('Порча'),
('Истек срок годности'),
('Приготовление блюд (внутреннее)'), -- Для случаев, когда списание идет не через продажу
('Бой/утеря'),
('Проработка нового блюда');

INSERT INTO "Касса" ("Номер_кассы", "Расположение") VALUES
('KACCA-01', 'Основной зал, стойка 1'),
('KACCA-02', 'Зал для банкетов');

INSERT INTO "Склад" ("Название", "Адрес") VALUES
('Основной склад', 'Подсобное помещение А'),
('Кухонный склад (холодный)', 'Холодильная камера 1'),
('Барный склад', 'Зона бара');

-- 2. Заполнение таблиц, зависящих от справочников

-- Предполагаемые ID из справочников:
-- КатегорияБлюда: 1-Роллы, 2-Суши, 3-Напитки
-- КатегорияПродукта: 1-Рыба, 2-Рис, 3-Овощи, 4-Молочные, 5-Соусы, 6-Бакалея
-- ЕдиницаИзмерения: 1-кг, 2-г, 3-л, 4-мл, 5-шт

INSERT INTO "Блюдо" ("ID_категории_блюда", "Название", "Цена_продажи") VALUES
(1, 'Ролл Филадельфия Классик', 450.00),
(1, 'Ролл Калифорния с крабом', 380.00),
(2, 'Суши с лососем', 120.00),
(2, 'Суши с угрем', 150.00),
(3, 'Лимонад домашний', 180.00);

INSERT INTO "Продукт" ("ID_категории_продукта", "ID_единицы_измерения", "Название", "Срок_годности_дни") VALUES
(1, 1, 'Лосось охлажденный', 3), -- Рыба, кг
(2, 1, 'Рис для суши "Фушигон"', 365), -- Рис, кг
(4, 2, 'Сыр сливочный "Филадельфия"', 30), -- Молочные, г
(6, 5, 'Листы нори "Gold"', 730), -- Бакалея, шт
(3, 2, 'Огурец свежий', 7), -- Овощи, г
(3, 2, 'Авокадо Хасс', 5), -- Овощи, г
(5, 4, 'Соус соевый "Kikkoman"', 180), -- Соусы, мл
(1, 2, 'Мясо краба (имитация)', 60), -- Рыба, г
(1, 2, 'Угорь унаги (филе)', 90); -- Рыба, г

INSERT INTO "Сотрудник" ("ID_должности", "Фамилия", "Имя", "Отчество", "Телефон", "Активен") VALUES
(1, 'Иванов', 'Иван', 'Иванович', '+79001234567', TRUE), -- Повар-сушист
(3, 'Петрова', 'Мария', 'Сергеевна', '+79007654321', TRUE), -- Кассир
(4, 'Сидоров', 'Алексей', 'Петрович', '+79001112233', TRUE), -- Администратор
(1, 'Ким', 'Дмитрий', 'Викторович', '+79004455666', TRUE); -- Повар-сушист

-- 3. Заполнение операционных таблиц

-- Предполагаемые ID:
-- Касса: 1
-- Сотрудник: 1-Иванов, 2-Петрова, 3-Сидоров
-- Склад: 1-Основной, 2-Кухонный
-- ПричинаСписания: 1-Порча

INSERT INTO "Заказ" ("ID_кассы", "ID_сотрудника_оформившего", "Тип_оплаты", "Общая_сумма") VALUES
(1, 2, 'Карта', 690.00), -- Петрова оформила
(1, 2, 'Наличные', 530.00);

INSERT INTO "Поступление" ("ID_склада", "ID_сотрудника_принявшего", "Номер_накладной") VALUES
(1, 3, 'Накл-00123'), -- Сидоров принял на основной склад
(2, 1, 'Накл-00124'); -- Иванов принял на кухонный склад

-- Для Списания (и наследуемых): ID_списания будет генерироваться автоматически
-- Запись 1: Списание продукта (унаследуется)
INSERT INTO "СписаниеПродуктов" (
    "ID_склада", "ID_сотрудника_ответственного", "ID_причины_списания", "Комментарий", -- Поля из "Списание"
    "ID_продукта", "Количество" -- Поля из "СписаниеПродуктов"
) VALUES (
    1, 1, 1, 'Обнаружена порча при вскрытии упаковки', -- Данные для "Списание"
    1, 0.500 -- Данные для "СписаниеПродуктов" (Лосось, 0.5 кг)
);

-- Запись 2: Списание блюда (унаследуется)
INSERT INTO "СписаниеБлюд" (
    "ID_склада", "ID_сотрудника_ответственного", "ID_причины_списания", "Комментарий", -- Поля из "Списание"
    "ID_блюда", "Количество" -- Поля из "СписаниеБлюд"
) VALUES (
    2, 1, 2, 'Образец для дегустации персоналом, срок подходил', -- Данные для "Списание"
    3, 1 -- Данные для "СписаниеБлюд" (Суши с лососем, 1 шт)
);


-- 4. Заполнение ассоциативных таблиц, деталей и состояний

INSERT INTO "ПозицияЗаказа" ("ID_заказа", "ID_блюда", "Количество", "Цена_на_момент_заказа") VALUES
(1, 1, 1, 450.00), -- Заказ 1: Ролл Филадельфия
(1, 3, 2, 120.00), -- Заказ 1: Суши с лососем (2 шт)
(2, 2, 1, 380.00), -- Заказ 2: Ролл Калифорния
(2, 5, 1, 150.00); -- Заказ 2: Лимонад (цена блюда 180, но тут цена на момент заказа 150 - для примера)

INSERT INTO "СоставБлюда" ("ID_блюда", "ID_продукта", "Количество") VALUES
(1, 1, 0.080), -- Филадельфия: Лосось (80г)
(1, 2, 0.100), -- Филадельфия: Рис (100г)
(1, 3, 0.050), -- Филадельфия: Сыр (50г)
(1, 4, 1.000), -- Филадельфия: Нори (1 лист)
(2, 8, 0.060), -- Калифорния: Краб (60г)
(2, 2, 0.100), -- Калифорния: Рис (100г)
(2, 6, 0.030), -- Калифорния: Авокадо (30г)
(2, 4, 1.000), -- Калифорния: Нори (1 лист)
(3, 1, 0.030), -- Суши с лососем: Лосось (30г)
(3, 2, 0.020); -- Суши с лососем: Рис (20г)

INSERT INTO "ПозицияПоступления" ("ID_поступления", "ID_продукта", "Количество", "Цена_закупки") VALUES
(1, 1, 5.000, 1200.00), -- Поступление 1: Лосось 5кг по 1200
(1, 2, 20.000, 150.00), -- Поступление 1: Рис 20кг по 150
(2, 3, 2.000, 800.00);  -- Поступление 2: Сыр 2кг (2000г) по 800 за кг (цена за единицу измерения продукта - грамм, значит 0.8 за грамм)

INSERT INTO "ОстатокПродуктаНаСкладе" ("ID_склада", "ID_продукта", "Количество") VALUES
(1, 1, 10.000), -- Основной склад: Лосось 10кг
(1, 2, 50.000), -- Основной склад: Рис 50кг
(2, 3, 3.000), -- Кухонный склад: Сыр 3кг (3000г)
(1, 4, 100.000), -- Основной склад: Нори 100 листов
(2, 1, 2.000); -- Кухонный склад: Лосось 2кг

INSERT INTO "Смена" ("ID_сотрудника", "ID_склада", "Дата_смены", "Время_начала", "Время_окончания") VALUES
(1, 2, CURRENT_DATE, '09:00:00', '18:00:00'), -- Иванов на кухонном складе
(2, NULL, CURRENT_DATE, '10:00:00', '19:00:00'), -- Петрова (кассир, склад не указан)
(4, 1, CURRENT_DATE - INTERVAL '1 day', '08:00:00', '17:00:00'); -- Ким на основном складе вчера

-- Завершение транзакции
COMMIT;

SELECT
    b."Название" AS "Блюдо",
    cb."Название" AS "Категория",
    b."Цена_продажи"
FROM
    "Блюдо" b
JOIN
    "КатегорияБлюда" cb ON b."ID_категории_блюда" = cb."ID_категории_блюда";